<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="893px" preserveAspectRatio="none" style="width:667px;height:893px;background:#FFFFFF;" version="1.1" viewBox="0 0 667 893" width="667px" zoomAndPan="magnify"><defs><filter height="300%" id="fubrvwgceg663" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fubrvwgceg663)" height="134.5527" style="stroke:#000000;stroke-width:2.0;" width="521" x="132" y="86.7988"/><rect fill="#FFFFFF" filter="url(#fubrvwgceg663)" height="396.0371" style="stroke:#000000;stroke-width:2.0;" width="527" x="10" y="235.3516"/><rect fill="#FFFFFF" filter="url(#fubrvwgceg663)" height="105.2422" style="stroke:#000000;stroke-width:2.0;" width="507" x="20" y="288.9727"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="81" x2="81" y1="40.4883" y2="850.252"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="171" x2="171" y1="40.4883" y2="850.252"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="324.5" x2="324.5" y1="40.4883" y2="850.252"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="466" x2="466" y1="40.4883" y2="850.252"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="585" x2="585" y1="40.4883" y2="850.252"/><rect fill="#FEFECE" filter="url(#fubrvwgceg663)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="98" x="30" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="37" y="25.5352">送信ファイル</text><rect fill="#FEFECE" filter="url(#fubrvwgceg663)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="98" x="30" y="849.252"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="37" y="869.7871">送信ファイル</text><rect fill="#FEFECE" filter="url(#fubrvwgceg663)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="54" x="142" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="149" y="25.5352">Client</text><rect fill="#FEFECE" filter="url(#fubrvwgceg663)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="54" x="142" y="849.252"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="149" y="869.7871">Client</text><rect fill="#FEFECE" filter="url(#fubrvwgceg663)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="57" x="294.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="301.5" y="25.5352">Server</text><rect fill="#FEFECE" filter="url(#fubrvwgceg663)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="57" x="294.5" y="849.252"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="301.5" y="869.7871">Server</text><rect fill="#FEFECE" filter="url(#fubrvwgceg663)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="98" x="415" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="422" y="25.5352">受信ファイル</text><rect fill="#FEFECE" filter="url(#fubrvwgceg663)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="98" x="415" y="849.252"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="422" y="869.7871">受信ファイル</text><rect fill="#FEFECE" filter="url(#fubrvwgceg663)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="112" x="527" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="534" y="25.5352">ロックファイル</text><rect fill="#FEFECE" filter="url(#fubrvwgceg663)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="112" x="527" y="849.252"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="534" y="869.7871">ロックファイル</text><polygon fill="#A80036" points="313,67.7988,323,71.7988,313,75.7988,317,71.7988" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="171" x2="319" y1="71.7988" y2="71.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="178" y="67.0566">connect</text><path d="M132,86.7988 L270,86.7988 L270,93.7988 L260,103.7988 L132,103.7988 L132,86.7988 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="134.5527" style="stroke:#000000;stroke-width:2.0;" width="521" x="132" y="86.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="93" x="147" y="100.3672">begin session</text><polygon fill="#A80036" points="313,121.4199,323,125.4199,313,129.4199,317,125.4199" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="171" x2="319" y1="125.4199" y2="125.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="178" y="120.6777">Fメッセージ送信</text><polygon fill="#A80036" points="573,150.7305,583,154.7305,573,158.7305,577,154.7305" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="325" x2="579" y1="154.7305" y2="154.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="332" y="149.9883">open(O_EXCL)</text><polygon fill="#A80036" points="454,180.041,464,184.041,454,188.041,458,184.041" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="325" x2="460" y1="184.041" y2="184.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31" x="332" y="179.2988">open</text><polygon fill="#A80036" points="182,209.3516,172,213.3516,182,217.3516,178,213.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="176" x2="324" y1="213.3516" y2="213.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="188" y="208.6094">Aメッセージ送信</text><path d="M10,235.3516 L132,235.3516 L132,242.3516 L122,252.3516 L10,252.3516 L10,235.3516 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="396.0371" style="stroke:#000000;stroke-width:2.0;" width="527" x="10" y="235.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="77" x="25" y="248.9199">put session</text><polygon fill="#A80036" points="92,269.9727,82,273.9727,92,277.9727,88,273.9727" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="86" x2="170" y1="273.9727" y2="273.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31" x="98" y="269.2305">open</text><path d="M20,288.9727 L94,288.9727 L94,295.9727 L84,305.9727 L20,305.9727 L20,288.9727 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="105.2422" style="stroke:#000000;stroke-width:2.0;" width="507" x="20" y="288.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="35" y="302.541">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="121" x="109" y="301.6074">[0, 送信ファイルサイズ]</text><polygon fill="#A80036" points="159,323.5938,169,327.5938,159,331.5938,163,327.5938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="81" x2="165" y1="327.5938" y2="327.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="88" y="322.8516">read</text><polygon fill="#A80036" points="313,352.9043,323,356.9043,313,360.9043,317,356.9043" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="171" x2="319" y1="356.9043" y2="356.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="178" y="352.1621">send</text><polygon fill="#A80036" points="454,382.2148,464,386.2148,454,390.2148,458,386.2148" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="325" x2="460" y1="386.2148" y2="386.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31" x="332" y="381.4727">write</text><polygon fill="#A80036" points="313,418.5254,323,422.5254,313,426.5254,317,422.5254" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="171" x2="319" y1="422.5254" y2="422.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="178" y="417.7832">shutdown(SHUT_WR)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="325" x2="367" y1="451.8359" y2="451.8359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="367" x2="367" y1="451.8359" y2="464.8359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="326" x2="367" y1="464.8359" y2="464.8359"/><polygon fill="#A80036" points="336,460.8359,326,464.8359,336,468.8359,332,464.8359" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="332" y="447.0938">データサイズ検証</text><line style="stroke:#A80036;stroke-width:2.0;" x1="177" x2="187" y1="504.457" y2="514.457"/><line style="stroke:#A80036;stroke-width:2.0;" x1="177" x2="187" y1="514.457" y2="504.457"/><line style="stroke:#A80036;stroke-width:1.0;" x1="183" x2="324" y1="509.457" y2="509.457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="188" y="489.4043">Aメッセージ送信</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="188" y="504.7148">が遅れる</text><line style="stroke:#A80036;stroke-width:1.0;" x1="171" x2="213" y1="538.7676" y2="538.7676"/><line style="stroke:#A80036;stroke-width:1.0;" x1="213" x2="213" y1="538.7676" y2="551.7676"/><line style="stroke:#A80036;stroke-width:1.0;" x1="172" x2="213" y1="551.7676" y2="551.7676"/><polygon fill="#A80036" points="182,547.7676,172,551.7676,182,555.7676,178,551.7676" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="178" y="534.0254">タイムアウト検知</text><line style="stroke:#A80036;stroke-width:1.0;" x1="171" x2="213" y1="581.0781" y2="581.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="213" x2="213" y1="581.0781" y2="594.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="172" x2="213" y1="594.0781" y2="594.0781"/><polygon fill="#A80036" points="182,590.0781,172,594.0781,182,598.0781,178,594.0781" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="178" y="576.3359">RSTパケット送信準備</text><polygon fill="#A80036" points="92,619.3887,82,623.3887,92,627.3887,88,623.3887" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="86" x2="170" y1="623.3887" y2="623.3887"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="98" y="618.6465">close</text><polygon fill="#A80036" points="313,655.6992,323,659.6992,313,663.6992,317,659.6992" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="171" x2="319" y1="659.6992" y2="659.6992"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="178" y="654.957">RSTパケット送信</text><line style="stroke:#A80036;stroke-width:1.0;" x1="325" x2="367" y1="689.0098" y2="689.0098"/><line style="stroke:#A80036;stroke-width:1.0;" x1="367" x2="367" y1="689.0098" y2="702.0098"/><line style="stroke:#A80036;stroke-width:1.0;" x1="326" x2="367" y1="702.0098" y2="702.0098"/><polygon fill="#A80036" points="336,698.0098,326,702.0098,336,706.0098,332,702.0098" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="332" y="684.2676">ソケット切断検知</text><line style="stroke:#A80036;stroke-width:1.0;" x1="325" x2="367" y1="731.3203" y2="731.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="367" x2="367" y1="731.3203" y2="744.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="326" x2="367" y1="744.3203" y2="744.3203"/><polygon fill="#A80036" points="336,740.3203,326,744.3203,336,748.3203,332,744.3203" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="332" y="726.5781">RSTパケット送信準備</text><polygon fill="#A80036" points="454,769.6309,464,773.6309,454,777.6309,458,773.6309" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="325" x2="460" y1="773.6309" y2="773.6309"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="332" y="768.8887">close</text><polygon fill="#A80036" points="573,798.9414,583,802.9414,573,806.9414,577,802.9414" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="325" x2="579" y1="802.9414" y2="802.9414"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="332" y="798.1992">remove</text><polygon fill="#A80036" points="182,828.252,172,832.252,182,836.252,178,832.252" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="176" x2="324" y1="832.252" y2="832.252"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="188" y="827.5098">RSTパケット送信</text><!--MD5=[aae88d9f44b35b74782e47c1fb01d30c]
@startuml timeout-err-sequence

participant "送信ファイル" as sendfile
participant "Client" as cl
participant "Server" as sv
participant "受信ファイル" as recvfile
participant "ロックファイル" as lockfile

cl -> sv: connect

group begin session
        cl -> sv: Fメッセージ送信
        sv -> lockfile: open(O_EXCL)
        sv -> recvfile: open
        sv -> cl: Aメッセージ送信
end

group put session
        cl -> sendfile: open

        loop 0, 送信ファイルサイズ
                sendfile -> cl: read
                cl -> sv: send
                sv -> recvfile: write
        end

        cl -> sv: shutdown(SHUT_WR)
        sv -> sv: データサイズ検証
        sv ->x cl: Aメッセージ送信\nが遅れる
        cl -> cl: タイムアウト検知
        cl -> cl: RSTパケット送信準備

        cl -> sendfile: close
end

cl -> sv: RSTパケット送信
sv -> sv: ソケット切断検知
sv -> sv: RSTパケット送信準備
sv -> recvfile: close
sv -> lockfile: remove
sv -> cl: RSTパケット送信

@enduml

PlantUML version 1.2021.14(Sat Nov 13 01:46:50 JST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: ja
Country: JP
--></g></svg>